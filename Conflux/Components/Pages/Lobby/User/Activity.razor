@page "/lobby/user/activity"

@using Conflux.Components.Shared
@using Conflux.Components.Shared.Icons
@using Conflux.Database.Entities
@using Conflux.Services
@using Conflux.Services.Abstracts

@inject IUserService UserService
@inject ApplicationRedirectManager RedirectManager
@inject ILogger<Activity> Logger

@if (_user == null) {
    <div class="size-full flex flex-row justify-center items-center">
        <Spinner class="size-16 fill-white"></Spinner>
    </div>

    return;
}

<div class="p-4 text-white">
    <h1 class="text-3xl font-bold">Activity</h1>
    <p class="text-sm text-gray-400">Your activities will be displayed here.</p>

    <section class="mt-2 border-t border-t-gray-600 py-2">
        <h1 class="text-xl font-semibold">Status</h1>
        <p class="text-sm text-gray-400 mb-3">Let others know you are or aren't up for conversation.</p>

        <div class="relative h-16 z-10 block sm:hidden">
            <div class="absolute inset-0 bg-white rounded-full flex flex-row justify-center items-center p-4">
                <p class="text-black text-center">google “magnesium iron silicate hydroxide”</p>
            </div>
            
            <div class="absolute left-1/2 bottom-0 -translate-x-1/2 translate-y-1/2 rotate-45 size-4 border-r-2 bg-white"></div>
        </div>
        
        <div class="flex flex-row justify-start items-center">
            <Avatar class="size-64 mx-auto sm:ml-4 mt-2 shadow-lg flex-none" ImageSrc="@_user.ProfilePicturePath"/>
                
            <div class="relative h-20 z-10 hidden sm:block flex-1">
                <div class="absolute inset-0 bg-white rounded-full flex flex-row justify-center items-center p-4">
                    <p class="text-black text-center">google “magnesium iron silicate hydroxide”</p>
                </div>
            
                <div class="absolute left-0 top-1/2 translate-x-[-40%] -translate-y-1/2 rotate-45 size-4 border-r-2 bg-white"></div>
            </div>
        </div>
    </section>
</div>

@code {
    private ApplicationUser? _user;

    [CascadingParameter] private Task<AuthenticationState> AuthenticationState { get; set; } = null!;

    protected override async Task OnAfterRenderAsync(bool firstRender) {
        if (firstRender) {
            var authState = await AuthenticationState;
            _user = await UserService.GetUserAsync(authState.User);

            if (_user == null) {
                RedirectManager.To("/").Execute();
                return;
            }

            StateHasChanged();
        }
    }
}