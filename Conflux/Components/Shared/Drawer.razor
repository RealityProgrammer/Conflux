@using System.Linq.Expressions

<div class="cursor-default fixed inset-0 z-1000 pointer-events-none @_cssClass" @attributes="AdditionalAttributes">
    <Overlay class="bg-transparent duration-200 ease-in-out" ActiveCssClass="bg-black/80!" OnClick="@OnClickOutside" @bind-Active="Open"/>
    
    <div class="fixed h-full @GetDirectionalCssClass() z-10 pointer-events-auto @ContainerCssClass">
        @ChildContent
    </div>
</div>

@code {
    [Parameter] public bool Open { get; set; }
    [Parameter] public EventCallback<bool> OpenChanged { get; set; }
    [Parameter] public Expression<Func<bool>>? OpenExpression { get; set; }

    [Parameter] public DrawerAnchorDirection Direction { get; set; }
    
    [Parameter] public EventCallback<MouseEventArgs> OnClickOutside { get; set; }
    
    [Parameter] public string? ContainerCssClass { get; set; }
    
    [Parameter, EditorRequired] public required RenderFragment ChildContent { get; set; }
    
    [Parameter(CaptureUnmatchedValues = true)] public IReadOnlyDictionary<string, object>? AdditionalAttributes { get; set; }
    private string? _cssClass;

    protected override void OnParametersSet() {
        if (AdditionalAttributes != null && AdditionalAttributes.TryGetValue("class", out object? obj)) {
            _cssClass = Convert.ToString(obj);
        }

        AdditionalAttributes = AdditionalAttributes?.Where(x => x.Key is not "class").ToDictionary();
    }

    private string GetDirectionalCssClass() {
        switch (Direction) {
            case DrawerAnchorDirection.Right:
                return $"right-0 {(Open ? "translate-x-0" : "translate-x-full")}";
                
            case DrawerAnchorDirection.Left:
            default:
                return $"left-0 {(Open ? "translate-x-0" : "-translate-x-full")}";
        }
    }
}