@using Conflux.Services

@inject ModalService ModalService
@inject IJSRuntime JavascriptRuntime

<div class="cursor-default fixed inset-0 z-1000 pointer-events-none flex justify-center items-center">
    <div @ref="_overlayElement" class="cursor-default absolute inset-0 pointer-events-auto bg-black/80" @onclick="CloseModal" style="opacity: 0"></div>

    <div @ref="_animateElement" class="w-full flex justify-center items-center" style="opacity: 0; transform: scale(0.8);">
        <CascadingValue Value="Info">
            <DynamicComponent Type="Info.Type" Parameters="Info.Parameters"/>
        </CascadingValue>
    </div>
</div>

@code {
    [Parameter] public ModalService.ModalInfo Info { get; set; }

    private ElementReference _overlayElement, _animateElement;

    protected override async Task OnAfterRenderAsync(bool firstRender) {
        if (firstRender) {
            await JavascriptRuntime.InvokeVoidAsync("window.animateModal", _animateElement, _overlayElement, 150);
        }
    }

    private void CloseModal() {
        ModalService.Close(Info.Id);
    }
}