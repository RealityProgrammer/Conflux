@using Conflux.Web.Services.Implementations
@inject ModalService ModalService
@inject IJSRuntime JavascriptRuntime

<div class="cursor-default fixed inset-0 z-1000 pointer-events-none flex justify-center items-center">
    <div @ref="_overlayElement" class="cursor-default absolute inset-0 pointer-events-auto bg-black/80" @onclick="CloseModal" style="opacity: 0"></div>

    <div @ref="_animateElement" class="absolute inset-0" style="opacity: 0; transform: scale(0.8);">
        <CascadingValue Value="Instance">
            <DynamicComponent @ref="_dynamicComponent" Type="Instance.ModalType" Parameters="Instance.Parameters"/>
        </CascadingValue>
    </div>
</div>

@code {
    [Parameter, EditorRequired] public IModalInstanceInternal Instance { get; set; }

    private ElementReference _overlayElement, _animateElement;
    private DynamicComponent? _dynamicComponent;

    protected override async Task OnAfterRenderAsync(bool firstRender) {
        if (firstRender) {
            await JavascriptRuntime.InvokeVoidAsync("window.animateModal", _animateElement, _overlayElement, 150);
            Instance.Component = _dynamicComponent!.Instance as BaseModal;
        }
    }

    private void CloseModal() {
        ModalService.Close(Instance.Id);
    }
}