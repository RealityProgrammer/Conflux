@using Conflux.Web.Helpers
@using System.ComponentModel.DataAnnotations
@inherits BaseModal

@{
    Action closeDelegate = EventUtils.AsNonRenderingEventHandler(CloseModal);
}

<div class="flex flex-row justify-center items-center size-full text-white">
    <Card class="w-4/5 sm:w-3/4 md:w-1/2 lg:w-1/3">
        <CardHeader Title="Dismiss Report" Subtext="False report, nothing to see here..." OnCloseRequested="closeDelegate"/>

        <CardContent>
            <EditForm Model="this" OnValidSubmit="OnValidSubmit">
                <DataAnnotationsValidator/>
                
                <label class="input-label">Reason</label>
                <InputTextArea @bind-Value="_reason" class="mt-1 input-field h-44 w-full px-1.5 py-1 resize-none" maxlength="512"/>
                
                <p class="text-gray-400 text-sm text-center mt-2">Are you sure you want to dismiss this report?<br/>This action cannot be reverted for the time being.</p>
                
                <div class="mt-2 flex flex-row justify-end gap-2">
                    <button type="button" class="button-cancel w-24" @onclick="closeDelegate">Cancel</button>
                    
                    <ProcessingStateButton IsProcessing="_isProcessingOperation" type="submit" class="button-primary w-24" ProcessingCssClass="flex flex-row justify-center items-center">
                        <ChildContent>
                            Confirm
                        </ChildContent>
                                
                        <ProcessingContent>
                            <Spinner class="size-5 fill-white"/>
                        </ProcessingContent>
                    </ProcessingStateButton>
                </div>
            </EditForm>
        </CardContent>
        
    </Card>
</div>

@code {
    [Parameter, EditorRequired] public EventCallback<string> OnConfirm { get; set; }

    [StringLength(32, ErrorMessage = "Reason cannot be longer than {1} characters.")] private string _reason = string.Empty;

    private bool _isProcessingOperation;

    private async Task OnValidSubmit() {
        if (OnConfirm.HasDelegate) {
            _isProcessingOperation = true;

            try {
                await OnConfirm.InvokeAsync(_reason);
            } finally {
                _isProcessingOperation = false;
            }
        }
        
        CloseModal();
    }
}