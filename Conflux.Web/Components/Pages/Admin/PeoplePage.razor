@page "/admin/people"
@using Conflux.Application.Dto
@using Conflux.Web.Components.Pages.Admin.Shared

@inject IStatisticsService StatisticsService

<h1 class="text-2xl font-semibold">User Management</h1>

<h2 class="text-lg mt-2">Userbase metrics</h2>

<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-2 mt-2">
    <Card class="border border-gray-600 shadow-md">
        <CardHeader Title="Total"/>
        
        <CardContent>
            @if (_isLoading) {
                <p class="text-right text-lg animate-pulse select-none">Loading...</p>
            } else {
                <p class="text-right text-xl">@_userStatistics.UserCount</p>
            }
        </CardContent>
    </Card>
    
    <Card class="border border-gray-600 shadow-md">
        <CardHeader Title="Online"/>
        
        <CardContent>
            @if (_isLoading) {
                <p class="text-right text-lg animate-pulse select-none">Loading...</p>
            } else {
                <p class="text-right text-xl">@_userStatistics.Online</p>
            }
        </CardContent>
    </Card>
    
    <Card class="border border-gray-600 shadow-md">
        <CardHeader Title="Banned"/>
        
        <CardContent>
            @if (_isLoading) {
                <p class="text-right text-lg animate-pulse select-none">Loading...</p>
            } else {
                <p class="text-right text-xl">@_userStatistics.Banned</p>
            }
        </CardContent>
    </Card>
</div>

<UserListView class="mt-2 w-full h-96"/>
<BannedUserListView class="mt-2 w-full h-96"/>

@code {
    private bool _isLoading = true;
    private UserStatisticsDTO _userStatistics;
    
    protected override async Task OnAfterRenderAsync(bool firstRender) {
        if (firstRender) {
            _userStatistics = await StatisticsService.GetUserStatistics();
            _isLoading = false;
            
            StateHasChanged();
        }
    }
}