@page "/settings/account"

@rendermode @(new InteractiveServerRenderMode(prerender: false))

@inject IUserService UserService

<div class="overflow-auto">
    <h1 class="font-bold text-3xl">Account Management</h1>

    <h2 class="font-bold text-xl mt-3">Password</h2>

    <p class="mt-3">
        Your password are encrypted in our database, therefore when an attacked is occured, your raw password will not
        be in plain text.
    </p>

    <p class="mt-2">Tips to strengthen your password:</p>

    <ul class="list-disc list-inside text-base/8">
        <li>Long password always better.</li>
        <li>Password should be unique between services (Conflux, Facebook, Youtube, Twitch, etc...) to minimize inflation damage.</li>
        <li>Avoid common words and personal information.</li>
        <li>Use mixture of arbitrary special characters and numbers along side with words.</li>
        <li>Avoid sequence of repeating characters.</li>
        <li>Use a password manager tool like <a target="_blank" href="https://bitwarden.com/">Bitwarden</a>.</li>
    </ul>

    <button class="button-primary mt-3">
        Change password (Not implemented)
    </button>

    <h2 class="font-bold text-xl mt-3">Authentication</h2>

    <p class="mt-3">Two-Factor Authentication</p>

    <p class="mt-1 text-sm">Adding two-factor authentication is a great way to make sure only you can log in.</p>

    @if (_enabled2FA) {
        <p class="mt-3 w-full p-2 border-2 rounded-xl border-green-500 bg-green-300/60">Two-Factor Authentication is enabled</p>
    } else {
        <p class="mt-3 w-full p-2 border-2 rounded-xl border-red-500 bg-red-500/60">Two-Factor Authentication is not enabled</p>
    }

    <button class="button-primary mt-3">
        Enable Two-Factor Authentication (Not implemented)
    </button>

    <p class="mt-3">SMS Authentication</p>
    <p class="mt-1">Adding SMS Authentication in case you lost access to the authentication app.</p>

    <button class="button-primary mt-3">
        Add SMS Authentication (Not implemented)
    </button>

    <h2 class="font-bold text-xl mt-3">Danger Zone</h2>
    <p class="mt-1">This is the danger zone, only proceed if you <span class="font-bold">truly</span> know what you are doing.</p>

    <ul class="border-2 border-red-500 mt-3 rounded-xl bg-red-500/20">
        <li class="p-4 flex flex-row items-center justify-between border-b border-b-gray-500">
            <div class="flex-1">
                <p class="font-bold">Logout</p>
                <p class="text-sm">Well, see you soon.</p>
            </div>

            <div class="flex-none">
                <LogoutButton ButtonCssClass="button-danger">
                    Logout
                </LogoutButton>
            </div>
        </li>

        <li class="p-4 flex flex-row items-center justify-between border-b border-b-gray-500">
            <div class="flex-1">
                <p class="font-bold">Temporary disable account</p>
                <p class="text-sm">Temporary disable means you can enable it at anytime.</p>
            </div>

            <div class="flex-none">
                <button class="button-danger">Disable Account</button>
            </div>
        </li>

        <li class="p-4 flex flex-row items-center justify-between border-b border-b-gray-500">
            <div class="flex-1">
                <p class="font-bold">Archive account</p>
                <p class="text-sm">The point of no return, you will not be able to log in, but people will still remember you.</p>
            </div>

            <div class="flex-none">
                <button class="button-danger">Archive Account</button>
            </div>
        </li>

        <li class="p-4 flex flex-row items-center justify-between">
            <div class="flex-1">
                <p class="font-bold">Delete account</p>
                <p class="text-sm">Same as archive, but your name, profiles, everything about you will be wiped out.</p>
            </div>

            <div class="flex-none">
                <button class="button-danger">Delete Account</button>
            </div>
        </li>
    </ul>
</div>

@code {
    private bool _enabled2FA;
    [CascadingParameter] private Task<AuthenticationState> AuthenticationState { get; set; } = null!;
    
    protected override async Task OnAfterRenderAsync(bool firstRender) {
        var authState = await AuthenticationState;
        _enabled2FA = await UserService.IsTwoFactorEnabled(authState.User);
    }
}