<div class="absolute left-5 right-5 @(IsShowing ? "bottom-5 translate-y-0" : "bottom-0 translate-y-full") bg-(--bg-color-1) px-3 py-2 shadow-md border border-(--bg-color-2) rounded-lg flex flex-row justify-between items-center transition-all duration-500 z-10000">
    Unsaved changes detected!
    
    <div class="flex-none inline-flex flex-row items-center gap-1">
        <button class="button-danger w-18 px-0 py-0 h-10" @onclick="HandleCancelClick">
            Cancel
        </button>
           
        <ProcessingStateButton @bind-IsProcessing="_isProcessingSave" class="button-success w-18 px-0 py-0 h-10" ProcessingCssClass="flex justify-center items-center" @onclick="HandleSaveClick">
            <ChildContent>
                Save
            </ChildContent>
            
            <ProcessingContent>
                <Spinner class="size-4 fill-white"></Spinner>
            </ProcessingContent>
        </ProcessingStateButton>
    </div>
</div>

@code {
    [Parameter] public EventCallback OnSaveRequest { get; set; }
    [Parameter] public EventCallback OnCancelRequest { get; set; }
    
    [Parameter] public bool IsShowing { get; set; }
    [Parameter] public EventCallback<bool> IsShowingChanged { get; set; }

    private bool _isShowing;
    private bool _isProcessingSave;

    protected override void OnParametersSet() {
        _isShowing = IsShowing;
    }

    private async Task HandleCancelClick() {
        await OnCancelRequest.InvokeAsync();

        _isShowing = false;
        await IsShowingChanged.InvokeAsync(false);
    }

    private async Task HandleSaveClick() {
        _isProcessingSave = true;

        try {
            await OnSaveRequest.InvokeAsync();
        } finally {
            _isProcessingSave = false;
        }
    }

    public async Task ShowPopup() {
        if (_isShowing) return;

        _isShowing = true;
        await IsShowingChanged.InvokeAsync(true);
    }

    public async Task HidePopup() {
        if (_isShowing) return;

        _isShowing = false;
        await IsShowingChanged.InvokeAsync(false);
    }
}